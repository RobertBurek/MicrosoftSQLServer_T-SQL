Instalacja Microsoft SQL Server 2017
Management Studio

T-SQL - Tworzenie bazy danych:

CREATE DATABASE MojeFinanse
CONTAINMENT = NONE
ON PRIMARY
( NAME = N'MojaBaza', FILENAME = N'D:\Program Files\Microsoft SQL Server\MSSQL12.MYSQLEXPRESS\MSSQL\DATA\MojeFinanse.mdf',
SIZE = 5120KB, MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )
LOG ON ( NAME = N'MojaBaza_log', FILENAME = N'D:\Program Files\Microsoft SQL Server\MSSQL12.MYSQLEXPRESS\MSSQL\DATA\MojeFinanse.ldf',
SIZE = 1024KB, MAXSIZE = 2048GB, FILEGROWTH = 10% )
GO

zmienne:

char(10) - dziesięć znaków, stałe, bez unicodu i zawsze 'AAA       '
varchar(50) - wszystkie znaki 50 i tylko zapisane 'AAA'
nchar(10)
text -  > 8000 znaków -> varchar(8000)
image -> text -binarny - varbinary()
int - naturalne
bigint - duże liczby
smallint - małe liczby
tinyint - malutkie
decimal(18,0) - max 38 znaków,
float - mało precyzyjny
real - jw
money - liczba 4 miejsca po przecinku, bez symbolu waluty
date - od 1.1.1 do 31.12.9999
datetime - 12:33:45 +data
datetime2(7)
smalldatetime inny zakres daty
binary(50) - flagi binarny
varbinary(50) > 8000znaków + obrazy
xml - dane xml
cursor - dane w pamięci kolumny i wiersze
table - cursor i tabela
sql_variant - bez określania wartości


Tworzenie tabeli dbo.Klienci w środowisku:

IDKlienta	int	Unchecked
IDTytuluKlienta	int	Checked
IDAdresu	int	Unchecked
Imie	varchar(50)	Unchecked
Nazwisko	varchar(50)	Unchecked
Inicjaly	varchar(10)	Checked
TypKonta	tinyint	Unchecked
OperacjeZaksiegowane	money	Unchecked
OperacjeNieZaksiegowane	money	Unchecked
DataOtwarcia	date	Unchecked
DataZamkniecia	date	Checked


Tworzenie tabeli dbo.Transakcje  T-SQL:

USE MojeFinanse
Go
CREATE TABLE Transakcje
(
IDTransakcji int IDENTITY(1,1) NOT NULL,
IDKlienta int NOT NULL,
TypTranskcji smallint NOT NULL,
DataUtworzenia datetime NOT NULL,
Kwota numeric(18,5) NOT NULL,
Szczegoly nvarchar(50) NULL,
Uwagi NVARCHAR(50) NULL,
IDAkcji int NULL,
IDProduktu int NOT NULL
)
GO


Tworzenie tabeli dbo.ProduktyKlientow   T-SQL:

USE MojeFinanse
Go
CREATE TABLE ProduktyKlientow
(
IDProduktuKlienta int NOT NULL,
IDKlienta int NOT NULL,
IDProduktuFinansowego int NOT NULL,
Kwota money NOT NULL,
Czestotliwosc smallint NOT NULL,
OstatniaWplata datetime NOT NULL,
OstatniaNaleznosc datetime NOT NULL,
Odnawialny bit NOT NULL,
)
GO


Pozostałe tabele   T-SQL:

dbo.ProduktyFinansowe

USE MojeFinanse
Go
CREATE TABLE ProduktyFinansowe
(
IDProduktu int NOT NULL,
NazwaProduktu nvarchar(50) NOT NULL,
)
GO

dbo.Akcje

USE MojeFinanse
Go
CREATE TABLE Akcje
(
IDAkcji int IDENTITY(1,1) NOT NULL,
Opis varchar(50) NOT NULL,
SymbolAkcji varchar(50) NULL,
BiezacaCena numeric(18,5) NOT NULL,
)
GO

dbo.CenyAkcji

USE MojeFinanse
Go
CREATE TABLE CenyAkcji
(
IDCenyAkcji bigint IDENTITY(1,1) NOT NULL,
IDAkcji int NOT NULL,
Cena numeric(18,5) NOT NULL,
Data datetime NOT NULL
)
GO

dbo.TypyTransakcji

USE MojeFinanse
Go
CREATE TABLE TypyTransakcji
(
IDTypuTransakcji smallint NOT NULL,
OpisTransakcji varchar(50) NOT NULL,
TypKredytu bit NOT NULL,
ZmianaStanuKonta bit NOT NULL
)
GO

Definiowanie kluczy podstawowych
Set Primary Key

ALTER TABLE Akcje 
ADD PRIMARY KEY (IDAkcji)
GO

ALTER TABLE CenyAkcji 
ADD PRIMARY KEY (IDCenyAkcji)
GO

ALTER TABLE TypyTransakcji 
ADD PRIMARY KEY (IDTypuTransakcji)
GO

ALTER TABLE Transakcje 
ADD PRIMARY KEY (IDTransakcji)
GO

ALTER TABLE ProduktyFinansowe 
ADD PRIMARY KEY (IDProduktu)
GO

ALTER TABLE ProduktyKlienta 
ADD PRIMARY KEY (IDProduktuKlienta)
GO


Tworzenie relacji między tabelami:
Selected Relationship
name: KO_Klienci_Transakcje
Tables And Columns Speci ...
dbo.Klienci.IDKlienta=dbo.Transakcje.IDKlienta
Enforce For Replication YES

ALTER TABLE ProduktyKlienta
ADD CONSTRAINT FK_ProduktyFinansowe_ProduktyKlienta
FOREIGN KEY (IDProduktuFinansowego)
REFERENCES ProduktyFinansowe(IDProduktu)
GO

ALTER TABLE ProduktyKlienta
ADD CONSTRAINT FK_Klienci_ProduktyKlienta
FOREIGN KEY (IDKlienta)
REFERENCES Klienci(IDKlienta)
GO

ALTER TABLE CenyAkcji
ADD CONSTRAINT FK_Akcje_CenyAkcji
FOREIGN KEY (IDAkcji)
REFERENCES Akcje(IDAkcji)
GO

ALTER TABLE Transakcje
ADD CONSTRAINT FK_Akcje_Transakcje
FOREIGN KEY (IDAkcji)
REFERENCES Akcje(IDAkcji)
GO

ALTER TABLE Transakcje
ADD CONSTRAINT FK_ProduktyFinansowe_Transakcje
FOREIGN KEY (IDProduktu)
REFERENCES ProduktyFinansowe(IDProduktu)
GO

Indeksy

Indeks klastrowany
Indeks nieklastrowany
Indeks podstawowych
Indeks wtórny XML

indeks unikatowy i nieunikatowy

cechy dobrego indeksu:
max 16 kolumn i 900 bajtów danych w kolumnie
- kolumny rzadko zmieniane,
- indeks klastrowany na kluczu
- wyszuliwanie rekordów danych 
- indeks pokrywający (np. całą tabelę)
- przeszukuwanie zakresu danych
- uporządkowanie danych

cechy złego indeksu:
- wybór nieodpowiednich kolumn
- wybór nieodpowiednich danych 
- wybór zbyt wielu kolumn
- zbyt mało rekordów w tabeli

do monitorowania indeksów
DATABASE INGINE TUNING ADVAISON

Tworzenie indeksu klastrowego  T-SQL:

USE MojeFinanse
GO
CREATE UNIQUE CLUSTERED INDEX IX_TypyTransakcji
ON TypyTransakcji(IDTypuTransakcji ASC)
WITH
(
STATISTICS_NORECOMPUTE = ON,
SORT_IN_TEMPDB = ON,
DROP_EXISTING = OFF,
IGNORE_DUP_KEY = ON,
ALLOW_ROW_LOCKS = ON,
ALLOW_PAGE_LOCKS = ON
)
GO

Tworzenie indeksu nieklastrowego  T-SQL:

USE MojeFinanse
GO
CREATE NONCLUSTERED INDEX IX_TypyTransakcji_NC
ON Transakcje(TypTransakcji ASC)
WITH
(
STATISTICS_NORECOMPUTE = OFF,
SORT_IN_TEMPDB = ON,
DROP_EXISTING = OFF,
IGNORE_DUP_KEY = OFF,
ALLOW_ROW_LOCKS = ON,
ALLOW_PAGE_LOCKS = ON
)
GO

Usunięcie indeksu w Management Studio
w tabeli dbo.Transakcje

utworzenie nowego indeksu na tej tabeli:

USE MojeFinanse
GO
CREATE UNIQUE CLUSTERED INDEX IX_KlienciDataTransakcji
ON Transakcje (IDKlienta ASC,DataUtworzenia ASC)
WITH
(
STATISTICS_NORECOMPUTE = ON,
SORT_IN_TEMPDB = ON,
DROP_EXISTING = OFF,
IGNORE_DUP_KEY = ON,
ALLOW_ROW_LOCKS = ON,
ALLOW_PAGE_LOCKS = ON
)
GO

Modyfikacja indeksu polega na usunięciu
i dodaniu nowego indeksu
DROP_EXISTING = ON,

USE MojeFinanse
GO
CREATE UNIQUE CLUSTERED INDEX IX_KlienciDataTransakcji
ON Transakcje (IDKlienta ASC,DataUtworzenia DESC)
WITH
(
STATISTICS_NORECOMPUTE = ON,
SORT_IN_TEMPDB = ON,
DROP_EXISTING = ON,
IGNORE_DUP_KEY = ON,
ALLOW_ROW_LOCKS = ON,
ALLOW_PAGE_LOCKS = ON
)
GO


Tworzenie diagramu bazy danych

ustawienie uzytkownika:

USE MojeFinanse
Go
ALTER AUTHORIZATION ON DATABASE :: MojeFinanse TO "sa"

Database Diagrams/New Database Diagram


Tworzenie bazy i tabel w pamięci  T-SQL
SQL SERVER wersji developer lub enterprise

Tworzenie bazy w pamięci:

USE MojeFinanse
GO
ALTER DATABASE MojeFinanse
ADD FILEGROUP [IN-MEMORY-PRIMARY]
CONTAINS MEMORY_OPTIMIZED_DATA

ALTER DATABASE MojeFinanse
ADD FILE
(
NAME='MojeFinanse-Pamiec',
FILENAME='D:\Program Files\Microsoft SQL Server\MSSQL12.MYSQLEXPRESS\MSSQL\DATA\MojeFinanse-Pamiec',
)
TO FILEGROUP [IN-MEMORY-PRIMARY]

Tworzenie tabeli w pamięci:

CREATE TABLE BiezaceCenyAkcji(
IdentyfikatorAkcji VARCHAR(50)
COLLATE Latin1_General_100_BIN2 NOT NULL
PRIMARY KEY NONCLUSTERED HASH
WITH (BUCKET_COUNT = 20000),
BiezacaCena NUMERIC(18,5) NOT NULL,
Czas SMALLDATETIME NOT NULL
)
WITH (
MEMORY_OPTIMIZED = ON,
DURABILITY = SCHEMA_AND_DATA,
)

